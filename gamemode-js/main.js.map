{"version":3,"file":"main.js","sources":["../src/parts/teamSelection/classes.js","../src/parts/teamSelection/index.js","../src/main.js"],"sourcesContent":["import { AddPlayerClass } from \"samp-node-lib\";\r\n\r\nexport const getClasses = () => {\r\n  AddPlayerClass(\r\n    299,\r\n    1759.0189,\r\n    -1898.126,\r\n    13.5622,\r\n    266.4503,\r\n    -1,\r\n    -1,\r\n    -1,\r\n    -1,\r\n    -1,\r\n    -1\r\n  );\r\n  AddPlayerClass(\r\n    300,\r\n    1759.0189,\r\n    -1898.126,\r\n    13.5622,\r\n    266.4503,\r\n    -1,\r\n    -1,\r\n    -1,\r\n    -1,\r\n    -1,\r\n    -1\r\n  );\r\n};\r\n","import {\r\n  GetPlayerKeys,\r\n  GetPlayerState,\r\n  GetTickCount,\r\n  IsPlayerConnected,\r\n  KEY,\r\n  OnGameModeInit,\r\n  OnPlayerConnect,\r\n  OnPlayerDeath,\r\n  OnPlayerRequestClass,\r\n  OnPlayerSpawn,\r\n  OnPlayerUpdate,\r\n  PlayerPlaySound,\r\n  PLAYER_STATE,\r\n  SetPlayerCameraLookAt,\r\n  SetPlayerCameraPos,\r\n  SetPlayerInterior,\r\n  TogglePlayerSpectating,\r\n} from \"samp-node-lib\";\r\nimport { getClasses } from \"./classes\";\r\n\r\nglobal.PlayerCitySelection = [];\r\nglobal.PlayerHasCitySelected = [];\r\nglobal.LastCitySelectionTick = [];\r\n\r\nconst CITY_LOS_SANTOS = 0;\r\nconst CITY_SAN_FIERRO = 1;\r\nconst CITY_LAS_VENTURAS = 2;\r\n\r\nOnGameModeInit(() => {\r\n  // Get all classes\r\n  getClasses();\r\n});\r\n\r\nOnPlayerConnect(({ playerid: id }) => {\r\n  // Team selection init vars\r\n  // class selection init vars\r\n  global.PlayerCitySelection[id] = -1;\r\n  global.PlayerHasCitySelected[id] = 0;\r\n  global.LastCitySelectionTick[id] = GetTickCount();\r\n\r\n  console.log(\r\n    global.PlayerCitySelection[id],\r\n    global.PlayerHasCitySelected[id],\r\n    global.LastCitySelectionTick[id]\r\n  );\r\n});\r\n\r\nOnPlayerSpawn(({ playerid: id }) => {});\r\n\r\nOnPlayerDeath(({ playerid: id }, killerid, reason) => {});\r\n\r\nconst SetupCharSelection = (id) => {};\r\n\r\nconst SetupSelectedCity = (id) => {\r\n  if (global.PlayerCitySelection[id] === -1) {\r\n    global.PlayerCitySelection[id] = CITY_LOS_SANTOS;\r\n  }\r\n\r\n  if (global.PlayerCitySelection[id] === CITY_LOS_SANTOS) {\r\n    SetPlayerInterior(id, 0);\r\n    SetPlayerCameraPos(id, 1630.6136, -2286.0298, 110.0);\r\n    SetPlayerCameraLookAt(id, 1887.6034, -1682.1442, 47.6167);\r\n  }\r\n\r\n  if (global.PlayerCitySelection[id] === CITY_SAN_FIERRO) {\r\n    SetPlayerInterior(id, 0);\r\n    SetPlayerCameraPos(id, -1300.8754, 68.0546, 129.4823);\r\n    SetPlayerCameraLookAt(id, -1817.9412, 769.3878, 132.6589);\r\n  }\r\n\r\n  if (global.PlayerCitySelection[id] === CITY_LAS_VENTURAS) {\r\n    SetPlayerInterior(id, 0);\r\n    SetPlayerCameraPos(id, 1310.6155, 1675.9182, 110.739);\r\n    SetPlayerCameraLookAt(id, 2285.2944, 1919.3756, 68.2275);\r\n  }\r\n};\r\n\r\nconst SwitchToNextCity = (id) => {\r\n  global.PlayerCitySelection[id]++;\r\n\r\n  if (global.PlayerCitySelection[id] > CITY_LAS_VENTURAS) {\r\n    global.PlayerCitySelection[id] = CITY_LOS_SANTOS;\r\n  }\r\n\r\n  PlayerPlaySound(id, 1052, 0.0, 0.0, 0.0);\r\n  global.LastCitySelectionTick[id] = GetTickCount();\r\n  SetupSelectedCity(id);\r\n};\r\n\r\nconst SwitchToPreviousCity = (id) => {\r\n  global.PlayerCitySelection[id]--;\r\n\r\n  if (global.PlayerCitySelection[id] < CITY_LOS_SANTOS) {\r\n    global.PlayerCitySelection[id] = CITY_LAS_VENTURAS;\r\n  }\r\n\r\n  PlayerPlaySound(id, 1053, 0.0, 0.0, 0.0);\r\n  global.LastCitySelectionTick[id] = GetTickCount();\r\n  SetupSelectedCity(id);\r\n};\r\n\r\nconst HandleCitySelection = (id) => {\r\n  const pKeys = GetPlayerKeys(id);\r\n\r\n  if (global.PlayerCitySelection[id] === -1) {\r\n    SwitchToNextCity(id);\r\n    return;\r\n  }\r\n\r\n  // only allow new selection every ~500 ms\r\n  if (GetTickCount() - global.LastCitySelectionTick[id] < 500) return;\r\n\r\n  if (pKeys[0] === KEY.FIRE || pKeys[0] === KEY.SECONDARY_ATTACK) {\r\n    global.PlayerHasCitySelected[id] = 1;\r\n    TogglePlayerSpectating(id, 0);\r\n    return;\r\n  }\r\n\r\n  if (pKeys[2] === KEY.RIGHT) {\r\n    SwitchToNextCity(id);\r\n  }\r\n\r\n  if (pKeys[2] === KEY.LEFT) {\r\n    SwitchToPreviousCity(id);\r\n  }\r\n};\r\n\r\nOnPlayerUpdate(({ playerid: id }) => {\r\n  if (!IsPlayerConnected(id)) {\r\n    return;\r\n  }\r\n\r\n  if (\r\n    !global.PlayerHasCitySelected[id] &&\r\n    GetPlayerState(id) == PLAYER_STATE.SPECTATING\r\n  ) {\r\n    HandleCitySelection(id);\r\n    return;\r\n  }\r\n});\r\n\r\nOnPlayerRequestClass(({ playerid: id }, classid) => {\r\n  if (GetPlayerState(id) != PLAYER_STATE.SPECTATING) {\r\n    TogglePlayerSpectating(id, 1);\r\n    global.PlayerCitySelection[id] = -1;\r\n  }\r\n});\r\n","//----------------------------------------------------------\r\n//\r\n//  TEST  1.0\r\n//  A node.js gamemode for SA-MP 0.3\r\n//\r\n//----------------------------------------------------------\r\n\r\nimport {\r\n  OnPlayerConnect,\r\n  GetPlayerName,\r\n  SendClientMessageToAll,\r\n  OnGameModeInit,\r\n  SetGameModeText,\r\n  OnGameModeExit,\r\n  ShowPlayerMarkers,\r\n  ShowNameTags,\r\n  SetNameTagDrawDistance,\r\n  EnableStuntBonusForAll,\r\n  DisableInteriorEnterExits,\r\n  SetWeather,\r\n  SetWorldTime,\r\n} from \"samp-node-lib\";\r\n\r\n// import { checkDbConnection } from \"./db\";\r\n\r\n// import \"./dialogs\";\r\n\r\n// This imports the team & class selection\r\nimport \"./parts/teamSelection\";\r\n\r\nOnGameModeInit(async () => {\r\n  // General settings\r\n  SetGameModeText(\"Test\");\r\n  ShowPlayerMarkers(2);\r\n  ShowNameTags(1);\r\n  SetNameTagDrawDistance(40);\r\n  EnableStuntBonusForAll(0);\r\n  DisableInteriorEnterExits();\r\n  SetWeather(2);\r\n  SetWorldTime(11);\r\n\r\n  // Check DB connection\r\n  //  await checkDbConnection();\r\n});\r\n\r\nOnGameModeExit(async () => {});\r\n\r\nOnPlayerConnect(({ playerid: id }) => {\r\n  const username = GetPlayerName(id, 20);\r\n\r\n  // Send join message to all\r\n  SendClientMessageToAll(\r\n    \"rgba(207,240,183,1)\",\r\n    `[JOIN] ${username} (id: ${id}) has joined the server. Welcome!`\r\n  );\r\n});\r\n"],"names":["AddPlayerClass","OnGameModeInit","OnPlayerConnect","GetTickCount","OnPlayerSpawn","OnPlayerDeath","SetPlayerInterior","SetPlayerCameraPos","SetPlayerCameraLookAt","PlayerPlaySound","GetPlayerKeys","KEY","TogglePlayerSpectating","OnPlayerUpdate","IsPlayerConnected","GetPlayerState","PLAYER_STATE","OnPlayerRequestClass","SetGameModeText","ShowPlayerMarkers","ShowNameTags","SetNameTagDrawDistance","EnableStuntBonusForAll","DisableInteriorEnterExits","SetWeather","SetWorldTime","OnGameModeExit","GetPlayerName","SendClientMessageToAll"],"mappings":"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"}